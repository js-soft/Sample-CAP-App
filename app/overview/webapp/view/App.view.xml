<mvc:View
  controllerName="overview.controller.App"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:viz="sap.viz.ui5.controls"
  xmlns:viz.data="sap.viz.ui5.data"
  xmlns:viz.feeds="sap.viz.ui5.controls.common.feeds"
  xmlns:layout="sap.ui.layout">

  <App>
    <pages>
      <Page title="{i18n>appTitle}">
        <content>

          <!-- Revenue by Day (full width) -->
          <VBox class="sapUiSmallMarginTop sapUiMediumMarginBottom">
            <viz:VizFrame
              id="lineRevenue"
              vizType="line"
              height="420px"
              width="100%"
              vizProperties="{title:{text: 'Revenue by Day'}}">
              <viz:dataset>
                <viz.data:FlattenedDataset data="{/RevenueByDay}">
                  <viz.data:dimensions>
                    <viz.data:DimensionDefinition name="Date" value="{orderDate}" />
                  </viz.data:dimensions>
                  <viz.data:measures>
                    <viz.data:MeasureDefinition name="Revenue" value="{revenue}" />
                  </viz.data:measures>
                </viz.data:FlattenedDataset>
              </viz:dataset>
              <viz:feeds>
                <viz.feeds:FeedItem uid="categoryAxis" type="Dimension" values="Date" />
                <viz.feeds:FeedItem uid="valueAxis" type="Measure" values="Revenue" />
              </viz:feeds>
            </viz:VizFrame>
          </VBox>

          <!-- Genre + Book side by side -->
          <layout:Grid defaultSpan="L6 M6 S12" class="sapUiSmallMarginTop">
            <layout:content>

              <!-- Orders by Genre -->
              <VBox>
                <viz:VizFrame
                  id="pieByGenre"
                  vizType="donut"
                  height="420px"
                  width="100%"
                  vizProperties="{title:{text:'Orders by Genre'},dataLabel:{visible:true,showTotal:true}}">
                  <viz:dataset>
                    <viz.data:FlattenedDataset data="{/OrdersByGenre}">
                      <viz.data:dimensions>
                        <viz.data:DimensionDefinition name="Genre" value="{genre}" />
                      </viz.data:dimensions>
                      <viz.data:measures>
                        <viz.data:MeasureDefinition name="Quantity" value="{quantity}" />
                      </viz.data:measures>
                    </viz.data:FlattenedDataset>
                  </viz:dataset>
                  <viz:feeds>
                    <viz.feeds:FeedItem uid="color" type="Dimension" values="Genre" />
                    <viz.feeds:FeedItem uid="size"  type="Measure"   values="Quantity" />
                  </viz:feeds>
                </viz:VizFrame>
              </VBox>

              <!-- Orders by Book -->
              <VBox>
                <viz:VizFrame
                  id="pieByBook"
                  vizType="pie"
                  height="420px"
                  width="100%"
                  vizProperties="{title:{text:'Orders by Book'},interaction:{selectability:{mode:'single'}},legend:{visible:true},dataLabel:{visible:true}}"
                  selectData="onBookSliceSelect">
                  <viz:dataset>
                    <viz.data:FlattenedDataset data="{/TopBooks}">
                      <viz.data:dimensions>
                        <!-- Single dimension: value = bookID (used for nav), displayValue = title (shown in chart) -->
                        <viz.data:DimensionDefinition name="Book" value="{bookID}" displayValue="{title}" />
                      </viz.data:dimensions>
                      <viz.data:measures>
                        <viz.data:MeasureDefinition name="Quantity" value="{quantity}" />
                      </viz.data:measures>
                    </viz.data:FlattenedDataset>
                  </viz:dataset>
                  <viz:feeds>
                    <viz.feeds:FeedItem uid="color" type="Dimension" values="Book" />
                    <viz.feeds:FeedItem uid="size"  type="Measure"   values="Quantity" />
                  </viz:feeds>
                </viz:VizFrame>
              </VBox>

            </layout:content>
          </layout:Grid>

          <!-- Top Customers -->
          <VBox>
            <viz:VizFrame
              id="pieByCustomers"
              vizType="bar"
              height="420px"
              width="100%"
              vizProperties="{title:{text:'Top Customers'},dataLabel:{visible:true,showTotal:true}}">
              <viz:dataset>
                <viz.data:FlattenedDataset data="{/TopCustomers?$orderby=revenue%20desc&amp;$top=3}">
                  <viz.data:dimensions>
                    <viz.data:DimensionDefinition name="Customer" value="{customer}" />
                  </viz.data:dimensions>
                  <viz.data:measures>
                    <viz.data:MeasureDefinition name="Revenue" value="{revenue}" />
                  </viz.data:measures>
                </viz.data:FlattenedDataset>
              </viz:dataset>
              <viz:feeds>
                <viz.feeds:FeedItem uid="categoryAxis" type="Dimension" values="Customer" />
                <viz.feeds:FeedItem uid="valueAxis"    type="Measure"   values="Revenue" />
              </viz:feeds>
            </viz:VizFrame>
          </VBox>

        </content>
      </Page>
    </pages>
  </App>
</mvc:View>
